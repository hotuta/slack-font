# Copyright Joyent, Inc. and other Node contributors.
# 2013 (C) Peter Rekdal Sunde

{
  'variables': {
    'target_arch%': 'x86',
    'library%': 'static_library',
    'openssl_enable_asm%': 0, # only supported with the Visual Studio 2012 (VC11) toolchain.
    'gcc_version%': 0,
    'is_clang%': 0,
  },
  'target_defaults': {
    'default_configuration': 'Debug',
    'configurations': {
      'Debug': {
        'defines': [
          'DEBUG',
          '_DEBUG'
        ],
        'defines!': [
          '_HAS_EXCEPTIONS=0'
        ],
        'cflags': [
          '-g',
          '-O0'
        ],
        'conditions': [
          ['target_arch=="x64"', {#
              'msvs_configuration_platform': 'x64',
            }
          ],
        ],
        'msvs_settings': {
          'VCCLCompilerTool': {
            'RuntimeLibrary': 3, #dynamic debug 
            'Optimization': 0, #/Od, no optimization
            'MinimalRebuild': 'false',
            'OmitFramePointers': 'false',
            'BasicRuntimeChecks': 3, # /RTC1
            'RuntimeTypeInfo': 'true',
            'ExceptionHandling': '2',
            'AdditionalOptions': [
              '/MP', #compile across multiple CPUs
            ],
          },
          'VCLinkerTool': {
            'LinkIncremental': 2, #enable incremental linking
            'IgnoreDefaultLibraryNames': [
              "LIBCMTD.lib",
            ],
            'conditions': 
            [
              ['target_arch=="x64"', {
                'TargetMachine': 17 # /MACHINE:X64
              }],
            ],
          },
        },
      },
      'Release': {
        'defines!': [
          '_HAS_EXCEPTIONS=0'
          ],
        'conditions': [
          ['target_arch=="x64"', {#
              'msvs_configuration_platform': 'x64',
            }
          ],
        ],
        'msvs_settings': {
          'VCCLCompilerTool': {
            'RuntimeLibrary': 2, #dynamic release 
            'Optimization': 3, #/Ox, full optimization
            'FavorSizeOrSpeed': 1, # /Ot, favour speed over size 
            'InlineFunctionExpansion': 2, #/Ob2, inline anything eligible
            'WholeProgramOptimization': 'true', # /GL, whole program optimization, needed for LTCG 
            'OmitFramePointers': 'true',
            'EnableFunctionLevelLinking': 'true',
            'EnableIntrinsicFunctions': 'true',
            'RuntimeTypeInfo': 'true',
            'ExceptionHandling': '2',
            'AdditionalOptions': [
              '/MP', #compile across multiple CPUs
            ],
          },
          'VCLibrarianTool': {
            'AdditionalOptions': [
              '/LTCG', #link time code generation
            ],
          },
          'VCLinkerTool': {
            'LinkTimeCodeGeneration': 1, #link - time code generation 
            'OptimizeReferences': 2, #/OPT:REF
            'EnableCOMDATFolding': 2, # /OPT: ICF 
            'LinkIncremental': 1, #disable incremental linking
            'IgnoreDefaultLibraryNames': [
              "LIBCMT.lib",
            ],
            'conditions': [
              ['target_arch=="x64"', {
                'TargetMachine': 17 # /MACHINE:X64
              }],
            ],
          },
        },
      },
    },
    'msvs_settings' : {
      'VCLinkerTool' : {
          'GenerateDebugInformation': 'true',
      }
    }
  },
}
